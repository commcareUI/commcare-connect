<!-- templates/worker_flagged_table.html -->
{% load render_table from django_tables2 %}

<div class="flex flex-col h-full" x-data="{
    selectedRows: [],
    toggleRow(index) {
        const rowIndex = this.selectedRows.indexOf(index);
        if (rowIndex === -1) {
            this.selectedRows.push(index);
        } else {
            this.selectedRows.splice(rowIndex, 1);
        }
    },
    toggleAll() {
        if (this.isAllSelected()) {
            this.selectedRows = [];
        } else {
            // Get all row indices from the table data
            this.selectedRows = [
                {% for row in table.rows %}
                    {{ row.record.index }}{% if not forloop.last %},{% endif %}
                {% endfor %}
            ];
        }
    },
    isAllSelected() {
        return {{ table.rows|length }} > 0 && this.selectedRows.length === {{ table.rows|length }};
    },
    isRowSelected(index) {
        return this.selectedRows.includes(index);
    }
}">
  <!-- Table Content -->
  <div class="flex-grow overflow-auto  rounded-lg">
    {% render_table table %}
  </div>

  <!-- Table Footer -->
  <div class="flex-shrink-0 flex bg-white shadow-sm items-center justify-between text-brand-deep-purple px-4 rounded-lg h-15 mt-2">
    <div class="flex items-center space-x-4">
        <button><i class="fa-light fa-arrow-rotate-left"></i></button>
        <button><i class="fa-light fa-arrow-rotate-right"></i></button>
        {% include "tailwind/components/toggle-view.html" %}
      </div>
      <div class="relative" x-data="{ isOpen: false }">
        <span class="lable cursor-pointer" @click="isOpen = !isOpen">
          Flags 9 
          <i class="fa-solid fa-chevron-down transition-transform duration-200"></i>
        </span>

        <div x-show="isOpen" 
             @click.outside="isOpen = false"
             x-transition:enter="transition ease-out duration-200"
             x-transition:enter-start="opacity-0 transform scale-95"
             x-transition:enter-end="opacity-100 transform scale-100"
             x-transition:leave="transition ease-in duration-150"
             x-transition:leave-start="opacity-100 transform scale-100"
             x-transition:leave-end="opacity-0 transform scale-95"
             class="absolute bottom-full mb-2  w-50 bg-white rounded-lg shadow-lg p-4 text-brand-deep-purple">
          <!-- Dropdown content goes here -->
          <div class="space-y-2">
            <span class="text-sm font-medium">Flags Type</span>
            <div class="pt-3 simple-overflow">
              {% for data in flag_details%}
                <div class="flex justify-between items-center py-2.5">
                    <span class="text-xs w-27">{{data.name}}</span>
                    <span class="text-xs">{{data.count}}</span>
                </div>
              {% endfor %}
            </div>
          </div>
        </div>
      </div>
      {% include "tailwind/components/pagination.html"%}
  </div>
</div>
