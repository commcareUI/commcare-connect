<div
  class="flex flex-col w-full gap-2"
  x-data="{
        selectedTab: 'flagged',
        selectedOption: '',
        isLoading: true,
        tabConfig: {
            flagged: { icons: ['sliders-simple']},
            review: { icons: ['sliders-simple'] },
            revalidate: { icons: ['sliders-simple'] },
            approved: { icons: ['sliders-simple'] },
            rejected: { icons: ['sliders-simple'] },
            all: { icons: ['sliders-simple'] },
        },
        tabs: [
            { id: 'flagged', label: 'Flagged', url: '/a/test-1/opportunity/1/tw/tables/worker_flagged_table' },
            { id: 'review', label: 'Review', url: '/a/test-1/opportunity/1/tw/tables/worker_review_table' },
            { id: 'revalidate', label: 'Revalidate', url: '/a/test-1/opportunity/1/tw/tables/worker_revalidate_table' },
            { id: 'approved', label: 'Approved', url: '/a/test-1/opportunity/1/tw/tables/worker_approved_table' },
            { id: 'rejected', label: 'Rejected', url: '/a/test-1/opportunity/1/tw/tables/worker_rejected_table' },
            { id: 'all', label: 'All', url: '/a/test-1/opportunity/1/tw/tables/worker_all_table' }
        ],
        init() {
            // Load initial worker content
            const workerTab = this.tabs.find(t => t.id === 'flagged');
            htmx.ajax('GET', workerTab.url, '#opportunity_worker_container');
            
            // Global handler to hide loading spinner after content swap
            document.body.addEventListener('htmx:afterSwap', () => {
                this.isLoading = false;
            });
        },
        switchTab(tabId) {
            this.isLoading = true;
            this.selectedTab = tabId;
            this.selectedOption = '';
            const tab = this.tabs.find(t => t.id === tabId);
            htmx.ajax('GET', tab.url, '#opportunity_worker_container');
        }
    }"
>
  <!-- Tabs -->
  <div class="flex relative mx-auto items-center justify-between w-full px-4 bg-slate-50 rounded-lg shadow-sm h-14">
    <div class="flex h-full gap-x-8 px-2">
      <template x-for="tab in tabs" :key="tab.id">
        <div
          :id="`${tab.id}-tab`"
          @click="switchTab(tab.id)"
          class="relative cursor-pointer text-sm h-full flex items-center"
          :class="{
            'text-brand-deep-purple font-medium': selectedTab === tab.id,
            'text-gray-500': selectedTab !== tab.id
          }"
        >
          <span x-text="tab.label"></span>
          <div
            class="absolute bottom-0 left-1/2 -translate-x-1/2 w-2/3 h-1.5 bg-brand-mango rounded-t-lg"
            x-show="selectedTab === tab.id"
          ></div>
        </div>
      </template>
    </div>

    <!-- Dynamic Tab Options -->
    <template x-for="(tab, id) in tabConfig" :key="id">
      <div x-show="selectedTab === id" class="flex gap-x-4 items-center">
        <template x-for="(icon, index) in tab.icons" :key="index">
          <button type="button" 
            @click="$dispatch('toggle-filter')"
            :class="{'button-icon': true}">
            <i :class="`fa-light fa-${icon} text-brand-deep-purple`"></i>
          </button>
        </template>
      </div>
    </template>
  </div>

  <!-- Tab Content Container with Loading Animation -->
  <div class="w-full h-160 bg-white z-10 relative rounded-lg ">
    <div 
      id="loading-spinner"
      x-show="isLoading"
      class="absolute inset-0 flex items-center justify-center z-10">
      <div class="animate-spin rounded-full h-12 w-12 border-4 border-brand-mango border-t-transparent"></div>
    </div>
    <div 
      id="opportunity_worker_container" 
      class="w-full h-160 overflow-hidden rounded-lg shadow-sm">
      <!-- Content loaded via htmx will be injected here -->
    </div>
    <div
    class="table-footer w-full flex items-center justify-between h-14 mt-2 bg-[#F8FAFC] shadow-sm text-brand-deep-purple py-2 px-4 rounded-lg">
    {% include "tailwind/components/pagination.html" %}
</div>
  </div>
</div>